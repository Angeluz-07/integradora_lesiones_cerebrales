{% extends "home.html" %}

{% block content %}
<div class="row py-3">
    <div class="col-8 col-xl-8">
        <div class="papaya" data-params="params"></div>
    </div>
    <div class="col-4 col-xl-4">
        <form action="{% url 'save_diagnostic' %}" method="POST">
            {% csrf_token %}
            <fieldset>
                <div class="row" hidden>
                    <div class="col-12 col-xl-12">
                        <label class="form-label">Usuario</label>
                        <select class="form-select form-select-sm" name="usuario">
                           <option value="{{user.id}}" selected>{{user}}</option>                                                          
                        </select>
                    </div>
                </div>
                <div class="row my-2">
                    <div class="col-12 col-xl-12">
                        <label class="form-label">Imagen MRI :</label>
                        <input class="form-control form-control-sm" type="text" name="ruta_Imagen" value={{original}}>
                    </div>
                </div>
                <div class="row" hidden>
                    <div class="col-12 col-xl-12">
                        <label class="form-label">Nombre Mask_MRI</label>
                        <input class="form-control form-control-sm" type="text" name="ruta_ImagenSegmentada" value={{mask}}>
                    </div>
                </div>
                <div class="row my-2">
                    <div class="col-12 col-xl-12">
                        <label class="form-label">Clase predicha :</label>
                        <input class="form-control form-control-sm" type="text" name="clase" value={{clase_pred}}>
                    </div>
                </div>
                <div class="row my-2">
                    <div class="col-12 col-xl-12">
                        <label class="form-label">Descripción :</label>
                        <textarea class="form-control" name="descripcion" cols="70" rows="5" >{{descripcion}}</textarea>
                        <!--p class="text-center">Puede colocar un comentario sobre el resultado</p-->
                    </div>
                </div>
                <div class="row" hidden>
                    <div class="col-12 col-xl-12">
                       <input class="form-check-input" type="checkbox" name="aprobado">
                       <label class="form-check-label">Aprobar resultado</label>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-xl-12">
                       <input type="hidden" name="clase_Correccion" value="sin corrección">
                    </div>
                    <div class="col-12 col-xl-12">
                        <input type="hidden" name="descripcion_Correccion" value="sin corrección">
                    </div>
                </div>
                <div class="row my-2">
                    <div class="col-6 col-xl-6">
                        <button type="submit" class="btn btn-success">Aprobar</button>
                    </div>
                    <div class="col-6 col-xl-3">
                        <a class="btn btn-primary" href="{% url 'diagnostic' 'update' %}">Rechazar</a>
                    </div>
                </div>                              
            </fieldset>
        </form>
    </div>        
</div>

{% endblock %}

{% block specific_scripts %}

    <script type="text/javascript">

        //https://stackoverflow.com/questions/48248333/django-cors-headers-not-working-at-all
        $.ajaxSetup({
            beforeSend: function (xhr)
            {
                xhr.setRequestHeader("origin","*");
            }
        });

        var params = [];
        {% if original and mask %}
            var URL_ORIGINAL = "{% url 'serve_file' original %}";
            var URL_MASK = "{% url 'serve_file' mask %}";
            
            console.log(URL_ORIGINAL);
            console.log(URL_MASK);

            params["images"] = [ URL_ORIGINAL,URL_MASK ];
            params["{{ mask }}"] = {lut: "Overlay (Negatives)"};
        {% endif %}
    </script>
{% endblock %}
